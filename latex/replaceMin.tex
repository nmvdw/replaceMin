\AgdaHide{
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{replaceMin}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Size}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⊔\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{max}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Sum}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Binary.PropositionalEquality}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{≡{-}Reasoning}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{infixl}\AgdaSpace{}%
\AgdaNumber{30}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⊛\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{30}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⇒\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{50}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⊗\AgdaUnderscore{}}}\<%
\end{code}
}

\section{Delayed Computations}
As we have seen, the Haskell implementation cannot automatically be transferred to Agda, because the termination cannot be guaranteed.
For that reason, we introduce a mechanism, which allows delaying computations.
Beside that, the termination must take these delays into account.

Let us start with thinking about delaying computations.
Types do not have any dependence on time: all their inhabitants are always available.
To make them depend on time, we look at types indexed by some type of times.
We call them \emph{timed types}.

\subsection{Timed Types}
The main ingredient for timed types, is thus the indexing type.
The most straightforward option would be the natural, but we shall refrain to use them.
Instead, we use \AF{Size} for the indices.
Before explaining why, let us precisely define what timed types are.

\begin{code}%
\>[0]\AgdaFunction{Time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{Time}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{Size}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Time}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\end{code}

In the remainder of this section, we explain how to use timed types.
For that we introduce several combinators: some of them to construct such types, some of them for actual programming.
The simplest lifts operations on types to timed types.

\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⇒\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedSet}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⊗\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedSet}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedSet}\<%
\\
\>[0]\AgdaFunction{c}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\<%
\end{code}

Timed types can be turned into types.
This corresponds to universal quantification in first order logic.
If we think of a time type as a predicate on times, 

\begin{code}%
\>[0]\AgdaFunction{□}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{□}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\<%
\end{code}

To see what is going on, let us look at an example of a timed type.

\begin{code}%
\>[0]\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\<%
\\
\>[0]\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\end{code}

The natural numbers are generated by zero and the successor.
We can define these operations on the timed natural as well.
They are defined pointwise.

\begin{code}%
\>[0]\AgdaFunction{Z}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaFunction{TimedNat}\<%
\\
\>[0]\AgdaFunction{Z}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaNumber{0}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\<%
\end{code}

At every time, we have both zero and the successor of each timed natural number.
Other operations, for example the minimum, are defined in the same way.
Note that the function \AF{⊓} takes the minimum of two natural numbers.

\begin{code}%
\>[0]\AgdaFunction{min}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{min}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊓}}\AgdaSpace{}%
\AgdaBound{m}\<%
\end{code}

The last combinator represents delayed computations.
For this, we need to look more closely to Agda's mechanism of sized types.
An important operation on sizes is the order and we use it to define an order on types.

\begin{code}%
\>[0]\AgdaFunction{Time<}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Time}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{Time<}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{Size<}}\AgdaSpace{}%
\AgdaBound{i}\<%
\end{code}

The set \AF{Time<} \AB{i} represents the times smaller than \AB{i}.
With this order, we can now defined delayed computations.

\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Time}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{coinductive}\<%
\\
%
\>[2]\AgdaKeyword{field}\AgdaSpace{}%
\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Time<}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{j}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{▻}\AgdaSpace{}%
\AgdaKeyword{public}\<%
\end{code}

The only inhabitants \AF{▻} \AB{A} \AB{i} are those of \AB{A} \AB{j} for \AB{j} smaller than \AB{i}.
This means that something in \AB{A} \AB{i} is only accessible in \AF{▻} \AB{A} \AB{k} for \AB{k} greater than \AB{i}.
Or, in words, this means that inhabitants of \AB{A} are only available in \AF{▻} \AB{A} at later times.

Before discussing examples, let us first look at how to program with delayed computations.
First, we give \AF{▻} the structure of an applicative functor.

\begin{code}%
\>[0]\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⊛\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{force}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}

Secondly, we give a fixpoint combinator and here the order plays a crucial role.
The reason of that, is because it allows broader priductivity checks.
The semantics guarantee that there is no infinitely decreasing sequence of sizes.
In particular, if a size decrease in every recursive call of some function, then this map is productive.

\begin{code}%
\>[0]\AgdaFunction{fix}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[0]\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{fix}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{j}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{fix}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{j}\AgdaSymbol{\}}\<%
\end{code}

We define the fixpoint of \AB{f} by repeatedly applying \AB{f}.
Since the argument of \AB{f} is delayed, we also need a delayed version of \AF{fix}, which we call \AF{▻fix}.
Note that this function calls \AF{fix} again, but the size decreases.
For that reason, this function is actually productive.

Now let us discuss an example of a timed type which uses \AF{▻}.

\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{LazyNat}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{LZ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaDatatype{LazyNat}\<%
\\
%
\>[2]\AgdaInductiveConstructor{LS}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaDatatype{LazyNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaDatatype{LazyNat}\AgdaSymbol{)}\<%
\end{code}

Again we have a constructor \AIC{LZ}, representing zero, and a constructor \AIC{LS}, representing the successor.
However, the successor is different, because it only accepts arguments from some previous time.
Using \AF{pure}, we can still embed the natural numbers into the lazy numbers.

\begin{code}%
\>[0]\AgdaFunction{ℕ{-}to{-}LazyNat}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaDatatype{LazyNat}\<%
\\
\>[0]\AgdaFunction{ℕ{-}to{-}LazyNat}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{LZ}\<%
\\
\>[0]\AgdaFunction{ℕ{-}to{-}LazyNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{LS}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ℕ{-}to{-}LazyNat}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\end{code}

This type is different from \AF{TimedNat}, which we define before.
Beside the natural numbers, \AF{LazyNat} also contains infinity.
Since \AIC{LS} has a lazy argument, we can take the fixpoint.

\begin{code}%
\>[0]\AgdaFunction{infinity}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaDatatype{LazyNat}\<%
\\
\>[0]\AgdaFunction{infinity}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{fix}\AgdaSpace{}%
\AgdaInductiveConstructor{LS}\<%
\end{code}

\section{Eliminating Traversals}
Now we have developed sufficient material to formalize the program.
We start by defining the relevant data types: a data type of natural numbers and a data type of trees.
Remember that we already defined \AF{TimedNat} as a constant family.
The data type of trees is defined the same way.

\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Tree}\<%
\\
%
\>[2]\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Tree}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\<%
\\
\>[0]\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\<%
\end{code}

This data type has two constructors \AF{TLeaf} and \AF{TNode}.
We also have delayed versions of them.

\begin{code}%
\>[0]\AgdaFunction{TLeaf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{TLeaf}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{TNode}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{TNode}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{▻Leaf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{▻Leaf}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaBound{t₁}\AgdaSpace{}%
\AgdaBound{t₂}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{t₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{t₂}\<%
\end{code}

\begin{code}%
\>[0]\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{T}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{T}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSymbol{(}\AgdaBound{T}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{T}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{feedback}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{T}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{T}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaBound{T}\<%
\\
\>[0]\AgdaFunction{feedback}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{))}\<%
\end{code}

Now we want to define the help function \AF{rmb}, which will be the argument for \AF{feedback}.
We take \AF{⊳ Tree} for \AB{B} and \AF{SizedNat} for \AB{U}.
Note that we must use \AF{⊳ Tree}, because otherwise we would not be able to apply \AIC{Node} or \AF{⊳Node}.

\begin{code}%
\>[0]\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{▻Leaf}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{let}%
\>[396I]\AgdaSymbol{(}\AgdaBound{l'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ml}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
\>[.]\<[396I]%
\>[6]\AgdaSymbol{(}\AgdaBound{r'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{mr}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\>[2]\AgdaKeyword{in}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaBound{l'}\AgdaSpace{}%
\AgdaBound{r'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{min}\AgdaSpace{}%
\AgdaBound{ml}\AgdaSpace{}%
\AgdaBound{mr}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{replaceMin}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{replaceMin}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{feedback}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaOperator{\AgdaPostulate{↑}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\<%
\end{code}

\section{Proving with Sized Types}
Our next goal is to prove correctness.
Before doing that, we need to define timed predicates, timed relations, and combinators on them.

\begin{code}%
\>[0]\AgdaFunction{TimedPredicate}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set₁}\<%
\\
\>[0]\AgdaFunction{TimedPredicate}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{TimedRelation}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set₁}\<%
\\
\>[0]\AgdaFunction{TimedRelation}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\end{code}

Next we define universal quantification and for that we use dependent products.
Given a sized type \AB{A} and a predicate on \AB{A}, we get another sized type.

\begin{code}%
\>[0]\AgdaFunction{∏}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedPredicate}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedSet}\<%
\\
\>[0]\AgdaFunction{∏}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{x}\<%
\end{code}

Furthermore, for each sized type \AB{A}, we have a relation on \AB{A} representing equality.
For this we use propositional equality in Agda.

\begin{code}%
\>[0]\AgdaFunction{eq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedRelation}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[0]\AgdaFunction{eq}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{y}\<%
\end{code}

\begin{code}%
\>[0]\AgdaFunction{Time<Set}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\<%
\\
\>[0]\AgdaFunction{Time<Set}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Time<}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{▻eq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{TimedSet}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{TimedRelation}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Time<Set}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Time<Set}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{▻eq}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Time<}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{eq}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{j}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{j}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{j}\AgdaSymbol{))}\<%
\end{code}

\section{Correctness}

\subsection{Specification}
\begin{code}%
\>[0]\AgdaFunction{replace}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{replace}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{▻Leaf}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
\>[0]\AgdaFunction{replace}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\end{code}

\begin{code}%
\>[0]\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{min}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{l}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\<%
\end{code}

\begin{code}%
\>[0]\AgdaFunction{replaceMin{-}spec}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{replaceMin{-}spec}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{valid}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{valid}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{∏}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{eq}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replaceMin{-}spec}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)))}\<%
\end{code}

\subsection{Proof}

\AgdaAlign{
\begin{code}%
\>[0]\AgdaFunction{rmb₁}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[613I]\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{∏}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[613I][@{}l@{\AgdaIndent{0}}]%
\>[9]\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{∏}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[9][@{}l@{\AgdaIndent{0}}]%
\>[11]\AgdaFunction{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)))))}\<%
\\
\>[0]\AgdaFunction{rmb₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{rmb₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\end{code}
\quad \AF{≡⟨} unfold \AF{rmb} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\AgdaSpace{}%
\AgdaComment{{-}{-} unfold rmb}\<%
\end{code}
  }
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\end{code}
\quad \AF{≡⟨} induction hypothesis, \AF{rmb₁} \AB{l} \AB{n} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb₁}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\end{code}
\quad \AF{≡⟨} induction hypothesis, \AF{rmb₁} \AB{r} \AB{n} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb₁}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\end{code}
\quad \AF{≡⟨} fold \AF{replace} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\AgdaSpace{}%
\AgdaComment{{-}{-} unfold replace}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaFunction{replace}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}
}

\AgdaAlign{
\begin{code}%
\>[0]\AgdaFunction{rmb₂}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[702I]\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{∏}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[702I][@{}l@{\AgdaIndent{0}}]%
\>[9]\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{∏}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[9][@{}l@{\AgdaIndent{0}}]%
\>[11]\AgdaFunction{eq}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{))))}\<%
\\
\>[702I][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{rmb₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{rmb₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\end{code}
\quad \AF{≡⟨} unfold \AF{rmb} \AF{⟩} 
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\AgdaSpace{}%
\AgdaComment{{-}{-} unfold rmb}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaFunction{min}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\end{code}
\quad \AF{≡⟨} induction hypothesis, \AF{rmb₂} \AB{r} \AB{n} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb₂}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaFunction{min}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\<%
\end{code}
\quad \AF{≡⟨} induction hypothesis, \AF{rmb₂} \AB{l} \AB{n} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{min}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb₂}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaFunction{min}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{l}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}
}

\begin{code}%
\>[0]\AgdaFunction{replace<}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{Time<Set}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{replace<}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{replace{-}pure}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaFunction{Time<Set}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{replace{-}pure}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{j}\AgdaSymbol{\}))}\<%
\end{code}

\AgdaAlign{
\begin{code}%
\>[0]\AgdaFunction{⊳replace}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[815I]\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{∏}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[815I][@{}l@{\AgdaIndent{0}}]%
\>[13]\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{∏}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaFunction{TimedNat}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[13][@{}l@{\AgdaIndent{0}}]%
\>[15]\AgdaFunction{▻eq}\AgdaSpace{}%
\AgdaFunction{TimedTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace<}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace{-}pure}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))))}\<%
\\
\>[815I][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{⊳replace}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{⊳replace}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Node}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Node}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{⊳replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Node}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Node}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))))}\AgdaSpace{}%
\AgdaBound{z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{⊳replace}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}}

\AgdaAlign{
\begin{code}%
\>[0]\AgdaFunction{rm{-}correct}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{valid}\AgdaSpace{}%
\AgdaFunction{replaceMin}\<%
\\
\>[0]\AgdaFunction{rm{-}correct}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{replaceMin}\AgdaSpace{}%
\AgdaBound{t}\<%
\end{code}
\quad \AF{≡⟨} unfold \AF{replaceMin}, \AF{feedback} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\AgdaSpace{}%
\AgdaComment{{-}{-} unfold replaceMin, feedback}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fix}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))))}\<%
\end{code}
\quad \AF{≡⟨} unfold \AF{fix} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\AgdaSpace{}%
\AgdaComment{{-}{-} unfold fix}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)))))}\<%
\end{code}
\quad \AF{≡⟨} rewrite \AF{rmb₁} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}%
\>[967I]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{force}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[.]\<[967I]%
\>[10]\AgdaSymbol{(}\AgdaFunction{rmb₁}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)))))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{))))}\<%
\end{code}
\quad \AF{≡⟨} rewrite \AF{⊳replace} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{⊳replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{))))))}\<%
\end{code}
\quad \AF{≡⟨} unfold \AF{pure} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\AgdaSpace{}%
\AgdaComment{{-}{-} unfold pure}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{))))))}\<%
\end{code}
\quad \AF{≡⟨} unfold \AF{fix} \AF{⟩}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\AgdaSpace{}%
\AgdaComment{{-}{-} unfold fix}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{))))))))}\<%
\end{code}
\quad \AF{≡⟨} rewrite \AF{rmb₂} \AF{⟩}}
\AgdaHide{
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{≡⟨}}\AgdaSpace{}%
\AgdaFunction{cong}%
\>[1039I]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)))}\<%
\\
\>[.]\<[1039I]%
\>[10]\AgdaSymbol{(}\AgdaFunction{rmb₂}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaFunction{▻fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fb{-}h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)))))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟩}}\<%
\end{code}}
\begin{code}%
\>[2][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{replace}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{min{-}tree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{∎}}\<%
\end{code}
}
