\AgdaHide{
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{ReplaceMin.replaceMin}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Size}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{SizedCombinators}\<%
\end{code}
}

We start by with the usual definition of binary trees.

\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Tree}\<%
\\
%
\>[2]\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Tree}\<%
\end{code}

Next we define lazy versions of the constructors \AIC{Leaf} and \AIC{Node}.
To do so, we use that \AF{▻} is an applicative functor.

\begin{code}%
\>[0]\AgdaFunction{▻Leaf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{▻Leaf}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaBound{t₁}\AgdaSpace{}%
\AgdaBound{t₂}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{pure}\AgdaSpace{}%
\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{t₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊛}}\AgdaSpace{}%
\AgdaBound{t₂}\<%
\end{code}

The function \AD{rmb} takes a tree \AB{t} and lazily evaluated natural number \AB{n} and it returns a pair.
The first coordinate of that pair is a lazily evaluated tree, which is \AB{t} with each value replaced by \AB{n}.
The second coordinate is the minimum of \AB{t}.

\begin{code}%
\>[0]\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{▻Leaf}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Node}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{let}%
\>[82I]\AgdaSymbol{(}\AgdaBound{l'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ml}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{l}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
\>[.]\<[82I]%
\>[6]\AgdaSymbol{(}\AgdaBound{r'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{mr}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{r}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{in}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{▻Node}\AgdaSpace{}%
\AgdaBound{l'}\AgdaSpace{}%
\AgdaBound{r'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ml}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊓}}\AgdaSpace{}%
\AgdaBound{mr}\AgdaSymbol{)}\<%
\end{code}

Now we define the actual program.

\begin{code}%
\>[0]\AgdaFunction{gconst₁}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{N}\AgdaSpace{}%
\AgdaBound{T}\AgdaSpace{}%
\AgdaBound{TN}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{SizedSet}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaBound{T}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{TN}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSpace{}%
\AgdaBound{T}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaBound{T}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{TN}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{gconst₁}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{const₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{curry}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\<%
\end{code}

\begin{code}%
\>[0]\AgdaFunction{replaceMin}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Tree}\<%
\\
\>[0]\AgdaFunction{replaceMin}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\end{code}

We first give the equation of which we take the fixpoint.
\AgdaAlign{
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[2]\AgdaKeyword{let}%
\>[7]\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaRecord{▻}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
%
\>[7]\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{gconst₁}\AgdaSpace{}%
\AgdaFunction{rmb}\AgdaSpace{}%
\AgdaBound{t}\<%
\end{code}

\begin{code}%
%
\>[7]\AgdaBound{fixpoint}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{□}\AgdaSymbol{(}\AgdaRecord{▻}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{Tree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊗}}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
%
\>[7]\AgdaBound{fixpoint}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{fix}\AgdaSpace{}%
\AgdaBound{f}\<%
\end{code}

\begin{code}%
%
\>[2]\AgdaKeyword{in}%
\>[7]\AgdaField{force}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{fixpoint}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaPostulate{∞}\<%
\end{code}
}
